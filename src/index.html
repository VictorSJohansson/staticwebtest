<!DOCTYPE html>
<html lang="sv" class="sv-no-js sv-template-myndsam-startsida">
<head>
   <meta charset="UTF-8">
   <script nonce="9740b910-9041-11ef-87cf-bd855e34e7f1" >(function(c){c.add('sv-js');c.remove('sv-no-js');})(document.documentElement.classList)</script>
   <title>Myndsam | Skatteverket</title>
   <meta name="robots" content="noindex, nofollow" />
   <link rel="preload" href="jquery.js" as="script">
   <link rel="preload" href="utils.js" as="script">
   <link rel="preload" href="portlets.js" as="script">
   <link rel="preload" href="envision.js" as="script">
                        <meta name="DC.Title" content="Myndsam" />
                                 <meta name="keywords" content="" />
                                 <meta name="description" content="Myndsam startsida" />
                                 <meta name="DC.Date.Created" content="2024-05-20" />
                                 <meta name="DC.Date.Modified" content="2024-10-11" />
                                 <meta name="DC.Identifier" content="https://www.skatteverket.se" />
                                 <meta name="DC.Format" content="text/html" />
                                 <meta name="DC.Type" content="text" />
                                 <meta name="SKV.Author" content="nisse.tuta@skatteverket.se" />
                                 <meta name="robots" content="" />
                                 <meta name="google-site-verification" content="9yaXOpOvmAORp7RIYpbP6BJeS-5rcrc0_DsolER28Tw" />
            <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, shrink-to-fit=no" />
   <meta name="dcterms.identifier" content="http://skatteverket.se">
   <meta name="dcterms.language" content="sv">
   <meta name="dcterms.format" content="text/html">
   <meta name="dcterms.type" content="text">
   <link rel="stylesheet" href="styles.css">
   <link rel="stylesheet" href="startsida-ai.css">
   <link rel="stylesheet" href="startsida.css">
   <link rel="stylesheet" href="portlets.css">
   <link rel="stylesheet" href="envision.css">
   <link rel="stylesheet" href="responsive-grids.css">
   <link rel="stylesheet" href="sitevision-spacing.css">
   <link rel="stylesheet" href="SiteVision.css">
   <link rel="stylesheet" href="rotmall.css">
 
   <script nonce="9740b910-9041-11ef-87cf-bd855e34e7f1">!function(t,e){t=t||"docReady",e=e||window;var n=[],o=!1,c=!1;function d(){if(!o){o=!0;for(var t=0;t<n.length;t++)try{n[t].fn.call(window,n[t].ctx)}catch(t){console&&console.error(t)}n=[]}}function a(){"complete"===document.readyState&&d()}e[t]=function(t,e){if("function"!=typeof t)throw new TypeError("callback for docReady(fn) must be a function");o?setTimeout(function(){t(e)},1):(n.push({fn:t,ctx:e}),"complete"===document.readyState?setTimeout(d,1):c||(document.addEventListener?(document.addEventListener("DOMContentLoaded",d,!1),window.addEventListener("load",d,!1)):(document.attachEvent("onreadystatechange",a),window.attachEvent("onload",d)),c=!0))}}("svDocReady",window);</script>
   <script src="jquery.js"></script>

<meta name="viewport" content="initial-scale=1, width=device-width, maximum-scale=2, user-scalable=yes"/>
<!--[if IE 7]>
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" >
<![endif]-->
<!--[if IE 8]>
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" >
<![endif]-->
<!--[if IE 9]>
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE9" >
<![endif]-->
      <link href="faviconSKV.ico" type="image/x-icon" rel="shortcut icon">
      <link href="iphone_favicon.png" rel="apple-touch-icon">
      

	<meta property="og:title" content="Myndsam" />

         <meta property="og:image" content="https://skatteverket.se/images/18.35c34f651660af3747c16d7/1538124880511/skv-fb-liggande.png" />
	
      <script>$svjq = jQuery.noConflict()</script>
      

         <link type="application/rss+xml" rel="alternate" href="https://skatteverket.se/4.dfe345a107ebcc9baf800017640/12.dfe345a107ebcc9baf800017646.portlet?state=rss&amp;sv.contenttype=text/xml;charset=UTF-8" title="Alla nyheter, notiser och pressmeddelanden" />
      <link type="application/rss+xml" rel="alternate" href="https://skatteverket.se/4.dfe345a107ebcc9baf800017593/12.dfe345a107ebcc9baf800017599.portlet?state=rss&amp;sv.contenttype=text/xml;charset=UTF-8" title="Endast nyheter och notiser" />
      <link type="application/rss+xml" rel="alternate" href="https://skatteverket.se/4.dfe345a107ebcc9baf800017652/12.dfe345a107ebcc9baf800017658.portlet?state=rss&amp;sv.contenttype=text/xml;charset=UTF-8" title="Pressmeddelanden" />
         <script nonce="9740b910-9041-11ef-87cf-bd855e34e7f1" >
   window.sv = window.sv || {};
   sv.UNSAFE_MAY_CHANGE_AT_ANY_GIVEN_TIME_webAppExternals = {};
   sv.PageContext = {
   pageId: '4.13948c0e18e810bfa0c48b9',
   siteId: '2.18e1b10334ebe8bc80000',
   userIdentityId: '',
   userIdentityReadTimeout: 0,
   userLocale: 'sv_SE',
   dev: false,
   csrfToken: '',
   html5: true,
   useServerSideEvents: false,
   nodeIsReadOnly: true
   };
   </script>
   <script nonce="9740b910-9041-11ef-87cf-bd855e34e7f1">!function(){"use strict";var t,n={},e={},i={};function r(t){return n[t]=n[t]||{instances:[],modules:{},bundle:{}},n[t]}document.querySelector("html").classList.add("js");var s={registerBootstrapData:function(t,n,i,r,s){var a,o=e[t];o||(o=e[t]={}),(a=o[i])||(a=o[i]={}),a[n]={subComponents:r,options:s}},registerInitialState:function(t,n){i[t]=n},registerApp:function(n){var e=n.applicationId,i=r(e);if(t){var s={};s[e]=i,s[e].instances=[n],t.start(s)}else i.instances.push(n)},registerModule:function(t){r(t.applicationId).modules[t.path]=t},registerBundle:function(t){r(t.applicationId).bundle=t.bundle},getRegistry:function(){return n},setAppStarter:function(n){t=n},getBootstrapData:function(t){return e[t]},getInitialState:function(t){return i[t]}};window.AppRegistry=s}();</script>
   </head>
<body class=" sv-responsive  env-m-around--0">
<div id="svid10_13948c0e18e810bfa0c477b" class="sv-layout"><div class="sv-html-portlet sv-portlet sv-skip-spacer sv-template-portlet
" id="svid12_13948c0e18e810bfa0c58af"><div id="Testwebbmeddelande"><!-- Testwebb-meddelande --></div><div class="testmsg">
   <h2>
      Välkommen till vår testwebb med AI
	</h2>
   <p>
      Här testar och utvecklar myndigheter i Sverige en gemensam webbplats för privatpersoner.<br>
      Uppdraget drivs av eSam – Offentlig samverkan för ökad digitalisering, <a href="https://esamverka.se">esamverka.se</a>.
   </p>
</div>
<style>
   .testmsg {
      font-weight: 700;
      font-size: 14px;
      background-color: #CE430B33;
      color: #000;
      bottom: 100px;
      left: 0;
      padding: 10px;
      margin: 0;
      z-index: 9999;
   }
    .testmsg h2 {
       margin: 0;
    }
</style></div>
<div class="sv-vertical sv-layout msa-header sv-template-layout" id="svid10_13948c0e18e810bfa0c477c"><div class="sv-vertical sv-layout sv-skip-spacer sv-template-layout" id="svid10_13948c0e18e810bfa0c477f"><div class="sv-vertical sv-layout sv-skip-spacer sv-template-layout" id="svid10_13948c0e18e810bfa0c4781"><div class="sv-image-portlet sv-portlet sv-skip-spacer sv-template-portlet
" id="svid12_13948c0e18e810bfa0c4782"><div id="Logo"><!-- Logo --></div><a href="/myndsam.4.13948c0e18e810bfa0c48b9.html"><img alt="" class="sv-noborder sv-svg" style="max-width:1554px;max-height:209px" width="1554" height="209" src="logo-myndsam.svg" /></a></div>
<div class="sv-html-portlet sv-portlet sv-template-portlet
" id="svid12_13948c0e18e810bfa0c4783"><div id="HTML"><!-- HTML --></div><a href="/myndsam" class="msa-header-hamburger">Meny</a></div>
</div>
</div>
<div class="sv-vertical sv-layout sv-template-layout" id="svid10_13948c0e18e810bfa0c4780"><div class="sv-script-portlet sv-portlet sv-skip-spacer sv-template-portlet
" id="svid12_13948c0e18e810bfa0c4784"><div id="Headermeny"><!-- Header meny --></div><div class="msa-header-menu">
   <ul class="msa-header-menu__list">
            <li class="msa-header-menu__item">
         <a class="msa-header-menu__link" href="https://skatteverket.se/myndsam#vadkanvihjalpadigmed">Områden</a>
      </li>
            <li class="msa-header-menu__item">
         <a class="msa-header-menu__link" href="https://skatteverket.se/myndsam#gemensammamyndighetsfunktioner">Gemensamma myndighetsfunktioner</a>
      </li>
            <li class="msa-header-menu__item">
         <a class="msa-header-menu__link" href="https://skatteverket.se/myndsam#guiderochsamlingssidor">Guider och samlingssidor</a>
      </li>
            <li class="msa-header-menu__item">
         <a class="msa-header-menu__link" href="https://skatteverket.se/myndsam#samhallsinformation">Samhällsinformation</a>
      </li>
         </ul>
</div></div>
</div>
</div>
<div class="sv-vertical sv-layout sv-template-layout" id="svid10_13948c0e18e810bfa0c477d"><div id="svid94_13948c0e18e810bfa0c47a2"><div class="sv-vertical sv-layout sv-skip-spacer sv-template-layout" style="background-color: #FFF9F4;" id="svid10_13948c0e18e810bfa0c47a3"><div class="sv-fluid-grid tolvkolumn sv-layout sv-skip-spacer sv-template-layout" style="max-width: 1488px; padding: 0 30px; width: 100%; box-sizing: border-box;" id="svid10_13948c0e18e810bfa0c47a5"><div class="sv-row sv-layout sv-skip-spacer sv-template-layout" id="svid10_13948c0e18e810bfa0c47a6"><div class="sv-layout sv-skip-spacer sv-column-12 sv-template-layout" id="svid10_13948c0e18e810bfa0c47a7"><div class="sv-vertical sv-layout sv-skip-spacer sv-template-layout" id="svid10_13948c0e18e810bfa0c47a8"><div id="svid94_13948c0e18e810bfa0c48c0" class="pagecontent sv-layout"><div id="Toppytastartsida"><!-- Toppyta startsida --></div><div class="sv-vertical sv-layout sv-skip-spacer" id="svid10_13948c0e18e810bfa0c494e"><div class="sv-vertical sv-layout sv-skip-spacer" id="svid10_13948c0e18e810bfa0c494f"><div class="sv-text-portlet sv-use-margins sv-skip-spacer" style="margin-top: 10px" id="svid12_13948c0e18e810bfa0c4951"><div id="Rubrik"><!-- Rubrik --></div><div class="sv-text-portlet-content"><h1 class="sidrubrikxxh1x" id="h-Valkommen">Välkommen</h1></div></div>
<div class="sv-text-portlet sv-use-margins" id="svid12_13948c0e18e810bfa0c4952"><div id="Ingress"><!-- Ingress --></div><div class="sv-text-portlet-content"><p class="ingress">Här hittar du <strong>information </strong>och <strong>tjänster </strong>som stödjer dig genom olika situationer i livet.</p></div></div>
</div>
<div class="sv-vertical sv-layout" id="svid10_13948c0e18e810bfa0c4950"><div class="sv-image-portlet sv-portlet sv-skip-spacer" id="svid12_13948c0e18e810bfa0c4955"><div id="Bild"><!-- Bild --></div><img alt="" class="sv-noborder sv-svg" style="max-width:680px;max-height:384px" width="680" height="384" src="startsida-hero.svg" /></div>
</div>
</div>
<div class="sv-vertical sv-layout" id="svid10_7b93bdc1926c186b0b38f"><div class="sv-text-portlet sv-use-margins sv-skip-spacer" id="svid12_7b93bdc1926c186b0b391"><div id="Chattbottitel"><!-- Chattbot titel --></div><div class="sv-text-portlet-content"><h2 class="underrubrikxxh2x" id="h-Chattbot">Chattbot</h2></div></div>
<div class="sv-text-portlet sv-use-margins" id="svid12_7b93bdc1926c186b0b392"><div id="Chattbotbrodtext"><!-- Chattbot brödtext --></div><div class="sv-text-portlet-content"><p class="normal">Fråga vår chattbot om vägledning genom livets olika situationer.</p></div></div>
<div class="sv-html-portlet sv-portlet" id="svid12_7b93bdc1926c186b0b390"><div id="ChattbotHTML"><!-- Chattbot (HTML) --></div><style>
   .msa-chattbott__input.active {
      height: 600px;
   }
</style>
<div class="msa-chattbot">
   <div class="msa-chattbot__form">
      <div class="msa-chattbot__image">
         <!--<img alt="" src="chattbot.svg"/>-->
         <img alt="" src="chattbot.svg"/>
      </div>
      <ul class="msa-chattbot__messages"></ul>
      <div class="msa-chattbot__input">
         <textarea placeholder="Skriv ditt meddelande här...">Hur tar jag körkort?</textarea>
      </div>
      <button id="startChatt">Skicka</button>
   </div>
</div>
<script>
document.getElementById('startChatt').addEventListener('click', function() {
    // Hämta värdet från textrutan och rensa textfältet
    const textarea = document.querySelector('.msa-chattbot__input textarea');
    const question = textarea.value.trim();

    // Kontrollera att frågan inte är tom
    if (question === '') {
        alert('Skriv en fråga innan du skickar!');
        return;
    }

    // Logga frågan för att säkerställa att vi skickar rätt data
    console.log('Sending question:', question);
    createMessage('USER', question);

    // Rensa textfältet
    textarea.value = '';

    document.querySelector('.msa-chattbot').classList.add('msa-chattbot--active');

    // Skapa ett element för de tre punkterna och visa dem direkt
    const typingMessage = createTypingMessage();
    
    // Skapa en POST-request
    fetch('/api/message', {  // URL till din backend
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'  // Ange att vi skickar JSON
        },
        body: JSON.stringify({ question: question })  // Skicka frågan som en JSON-sträng
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.text();  // Använd 'text' om ditt svar inte är JSON
    })
    .then(data => {
        // Hantera svaret från servern
        const parseddata = JSON.parse(data);
        console.log("Data: ", parseddata);

        // Hämta chatbotens meddelande och länkar
        const chatbotMessage = parseddata.content;  // Hämta chatbotens meddelande
        const links = parseddata.links || [];  // Hämta länkar om de finns

        // Processa chatbotens meddelande för att lägga till länkar och ersätta [docX]
        const finalMessage = processMessage(chatbotMessage, links);

        // Ta bort de tre punkterna (den väntande indikatorn)
        removeTypingMessage(typingMessage);

        // Uppdatera chatten med det bearbetade meddelandet
        createMessage('CHATTBOTT', finalMessage);  // Uppdatera chatten med meddelandet

        console.log('Success:', finalMessage);
    })
    .catch((error) => {
        // Fånga och logga eventuella fel
        console.error('Error:', error);
    });
});

function createTypingMessage() {
    const $message = document.createElement('li');
    $message.classList.add('msa-chattbot__message', 'msa-chattbot__message--chattbot');
    
    const $sender = document.createElement('span');
    $sender.innerHTML = 'Chattbot: ';
    $message.appendChild($sender);
    
    const $writingResponse = document.createElement('span');
    $writingResponse.innerHTML = '...';  // Respons på att chattbotten tänker
    $message.appendChild($writingResponse);

    document.querySelector('.msa-chattbot__messages').appendChild($message);
    
    return $message;  // Returnera elementet så att vi kan ta bort det senare
}

function removeTypingMessage(typingMessage) {
    typingMessage.remove();  // Ta bort de tre punkterna när svaret kommer
}

function processMessage(message, links) {
    // Hitta alla [docX] i meddelandet
    const docRegex = /\[doc(\d+)\]/g;
    const sources = {};

    // Ersätt alla [docX] med (X) och samla in länkarna
    const processedMessage = message.replace(docRegex, (match, p1) => {
        const docNumber = parseInt(p1);
        if (links[docNumber - 1]) {
            // Spara länken i en referenslista
            sources[docNumber] = links[docNumber - 1];
            return `(${docNumber})`;
        } else {
            return `(X)`; // If no link exists for the docX
        }
    });

    // Skapa källor-sektionen där varje länk har sin egen rad
    let sourcesSection = "<p><strong>Källor:</strong></p><ul>";
    for (const [docNumber, link] of Object.entries(sources)) {
        sourcesSection += `<li>${docNumber}. <a href="${link}" target="_blank">${link}</a></li>`;
    }
    sourcesSection += "</ul>";

    // Returnera hela meddelandet inklusive källor
    return processedMessage + sourcesSection;
}

function createMessage(user, message, links) {
    const $message = document.createElement('li');
    $message.classList.add('msa-chattbot__message');
    $message.classList.add(
        user === 'USER'
            ? 'msa-chattbot__message--user'
            : 'msa-chattbot__message--chattbot'
    );
    const $sender = document.createElement('span');
    $sender.innerHTML = user === 'USER' ? 'Du: ' : 'Chattbot: ';
    $message.appendChild($sender);
   
    document.querySelector('.msa-chattbot__messages').appendChild($message);

    const $messageText = document.createElement('span');
    $messageText.style.whiteSpace = 'pre-wrap';  // Bevarar radbrytningar
    $messageText.innerHTML = message;
    (links || []).forEach(({ label, url }) => {
        let $link = document.createElement('a');
        $link.setAttribute('href', url);
        $link.innerHTML = label;
        $messageText.appendChild($link);
    });

    $message.appendChild($messageText);
}


</script>
</div>
</div>
</div></div>
</div>
</div>
</div>
</div>
<div class="sv-vertical sv-layout sv-template-layout" id="svid10_13948c0e18e810bfa0c47a4"><div id="svid94_13948c0e18e810bfa0c48c1" class="pagecontent sv-layout"><div id="Innehall"><!-- Innehåll --></div><div class="sv-fluid-grid tolvkolumn sv-layout sv-skip-spacer" style="max-width: 1488px; padding: 0 30px; width: 100%; box-sizing: border-box;" id="svid10_13948c0e18e810bfa0c4957"><div class="sv-text-portlet sv-use-margins sv-skip-spacer" style="padding-top:2em;padding-bottom:1em" id="svid12_13948c0e18e810bfa0c495a"><div id="Vadkanvihjalpadigmed"><!-- Vad kan vi hjälpa dig med? --></div><div class="sv-text-portlet-content"><h2 class="underrubrikxxh2x" id="h-sv-default-anchor"><a id="vadkanvihjalpadigmed"></a>Vad kan vi hjälpa dig med?</h2></div></div>
<div class="sv-script-portlet sv-portlet" id="svid12_13948c0e18e810bfa0c495d"><div id="Omradeslankar"><!-- Områdeslänkar --></div><script>
   function showAllAreaLinks() {
      document.querySelector(".msa-linkbox-container").classList.remove("msa-linkbox-container--limit");
   }
   
   function showLessAreaLinks() {
      document.querySelector(".msa-linkbox-container").classList.add("msa-linkbox-container--limit");
   }
</script>
